{
  "result": {
    "relationships": [
      {
        "source_table": "labs_table",
        "target_table": "diagnosis_table",
        "source_column": "subject_id",
        "target_column": "subject_id",
        "relation_type": "M:N",
        "confidence": 0.78,
        "description": "Both tables are transactional and share subject_id; however neither table is a clear parent dimension. Joining on subject_id alone creates many-to-many matches (multiple labs per subject and multiple diagnoses per subject). Treat as a contextual join key rather than a strict FK unless a patient/demographics table exists.",
        "llm_inferred": true
      },
      {
        "source_table": "labs_table",
        "target_table": "diagnosis_table",
        "source_column": "chart_time",
        "target_column": "chart_time",
        "relation_type": "M:N",
        "confidence": 0.6,
        "description": "chart_time is repeated (not unique) and is a timestamp, not an identifier. Using it as an FK is unreliable because multiple events can occur at the same time and timestamps may not align exactly across domains (labs vs diagnoses). Prefer time-window joins rather than FK constraints.",
        "llm_inferred": true
      }
    ],
    "hierarchy": [
      {
        "level": 1,
        "entity_name": "Patient",
        "anchor_column": "subject_id",
        "mapping_table": null,
        "confidence": 0.86
      },
      {
        "level": 2,
        "entity_name": "Clinical Event (time-indexed per patient)",
        "anchor_column": "chart_time",
        "mapping_table": null,
        "confidence": 0.7
      },
      {
        "level": 3,
        "entity_name": "Lab Measurement",
        "anchor_column": "item_name",
        "mapping_table": "labs_table",
        "confidence": 0.84
      },
      {
        "level": 3,
        "entity_name": "Diagnosis Assignment",
        "anchor_column": "icd10_cm",
        "mapping_table": "diagnosis_table",
        "confidence": 0.84
      }
    ],
    "reasoning": "Validated FK candidates conservatively: subject_id is a strong shared entity key but, given only transactional tables (labs and diagnoses) and no patient dimension table, it should not be enforced as a strict FK between the two fact-like tables. chart_time is repeated and functions as an event timestamp, not a stable identifier; it is unsuitable as an FK and should be used for temporal alignment (e.g., nearest/within-window joins). Domain-wise, both labs_table and diagnosis_table are child entities of an implied Patient entity (subject_id). At the same patient and time level, each table can have multiple rows (multiple lab tests; multiple diagnoses), yielding M:N if directly related."
  },
  "prompt_hash": "b2eced663f92fbf566b4421f50669a16",
  "cached_at": "2025-12-21T21:05:36.713251",
  "context_summary": {
    "filename": "unknown",
    "num_columns": 0
  }
}