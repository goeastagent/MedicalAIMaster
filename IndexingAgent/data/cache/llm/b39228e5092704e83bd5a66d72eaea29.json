{
  "result": {
    "relationships": [
      {
        "source_table": "labs",
        "target_table": "operations",
        "source_column": "subject_id",
        "target_column": "subject_id",
        "relation_type": "N:1",
        "confidence": 0.82,
        "description": "Lab results are transactional measurements recorded per patient over time; multiple lab rows can exist for a single patient who may have one or more operations. The shared patient identifier supports a patient-level linkage, though operations is encounter/procedure-scoped and may not cover all lab times.",
        "llm_inferred": true
      },
      {
        "source_table": "labs",
        "target_table": "diagnosis",
        "source_column": "subject_id",
        "target_column": "subject_id",
        "relation_type": "M:N",
        "confidence": 0.78,
        "description": "Both labs and diagnosis are event/transaction tables keyed by subject_id with repeated chart_time; neither table provides a stable unique key to serve as a parent. Joining on subject_id (and optionally time windows) yields many-to-many associations rather than a true FK.",
        "llm_inferred": true
      },
      {
        "source_table": "labs",
        "target_table": "medications",
        "source_column": "subject_id",
        "target_column": "subject_id",
        "relation_type": "M:N",
        "confidence": 0.78,
        "description": "Labs and medications are both longitudinal event tables per patient; subject_id is a shared patient identifier but does not make one table a parent of the other. Associations are typically derived by subject_id and temporal alignment, not enforced by FK.",
        "llm_inferred": true
      },
      {
        "source_table": "labs",
        "target_table": "ward_vitals",
        "source_column": "subject_id",
        "target_column": "subject_id",
        "relation_type": "M:N",
        "confidence": 0.76,
        "description": "Ward vitals and labs share the same column set (subject_id, chart_time, item_name, value) but represent different measurement domains. This indicates parallel fact tables rather than FK; any linkage is patient/time-based and many-to-many.",
        "llm_inferred": true
      },
      {
        "source_table": "labs",
        "target_table": "vitals",
        "source_column": "subject_id",
        "target_column": "subject_id",
        "relation_type": "M:N",
        "confidence": 0.76,
        "description": "Vitals includes op_id (procedure/encounter context) while labs does not; subject_id alone supports patient-level association but not a strict FK. Relationship is best treated as many-to-many via patient and time alignment.",
        "llm_inferred": true
      },
      {
        "source_table": "labs",
        "target_table": "clinical_data",
        "source_column": "subject_id",
        "target_column": "subjectid",
        "relation_type": "N:1",
        "confidence": 0.74,
        "description": "Column name similarity suggests subject_id maps to clinical_data.subjectid, but the datasets appear to come from different sources (INSPIRE vs Open_VitalDB) with different primary identifiers (subject vs case). Treat as a possible cross-dataset mapping, not a confirmed FK.",
        "llm_inferred": true
      }
    ],
    "hierarchy": [
      {
        "level": 1,
        "entity_name": "Patient",
        "anchor_column": "subject_id",
        "mapping_table": null,
        "confidence": 0.86
      },
      {
        "level": 2,
        "entity_name": "Encounter/Procedure (Operation)",
        "anchor_column": "op_id",
        "mapping_table": "operations",
        "confidence": 0.82
      },
      {
        "level": 3,
        "entity_name": "Clinical Events (Diagnoses / Medications)",
        "anchor_column": "subject_id",
        "mapping_table": null,
        "confidence": 0.8
      },
      {
        "level": 4,
        "entity_name": "Measurements (Labs / Vitals / Ward Vitals)",
        "anchor_column": "subject_id",
        "mapping_table": null,
        "confidence": 0.84
      }
    ],
    "reasoning": "Validated FK candidates conservatively: shared columns like chart_time, item_name, and value are not foreign keys (they are attributes of measurement facts and are not stable identifiers; chart_time is repeated). The only plausible key-like linkage is subject_id, which can support N:1 from labs (many lab rows) to a patient-level entity; however, no explicit patient dimension table is present, so the closest existing parent-like table is operations (contains subject_id and encounter/procedure context). Relationships between labs and other event tables (diagnosis, medications, vitals, ward_vitals) are best modeled as many-to-many associations derived by subject_id and temporal alignment rather than enforced FKs. Cross-dataset linkage to Open_VitalDB tables (clinical_data/lab_data) is uncertain due to differing identifiers (caseid vs subject_id), so confidence is kept < 0.8."
  },
  "prompt_hash": "b39228e5092704e83bd5a66d72eaea29",
  "cached_at": "2025-12-17T13:17:40.422098",
  "context_summary": {
    "filename": "unknown",
    "num_columns": 0
  }
}