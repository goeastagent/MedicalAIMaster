{
  "result": {
    "relationships": [
      {
        "source_table": "diagnosis",
        "target_table": "labs",
        "source_column": "subject_id",
        "target_column": "subject_id",
        "relation_type": "M:N",
        "confidence": 0.78,
        "description": "Both tables are event/transactional and share subject_id; however neither table provides a unique patient/encounter key, so subject_id alone does not form a reliable FK. At best, diagnoses and labs are many-to-many via the patient (and time), but this is an analytical join rather than a strict FK constraint.",
        "llm_inferred": true
      },
      {
        "source_table": "diagnosis",
        "target_table": "medications",
        "source_column": "subject_id",
        "target_column": "subject_id",
        "relation_type": "M:N",
        "confidence": 0.78,
        "description": "Both are transactional event tables keyed by subject_id + chart_time-like timestamps; without a patient dimension table or encounter_id, subject_id is not a strict FK. Conceptually diagnoses and medications relate many-to-many through the patient and time window.",
        "llm_inferred": true
      },
      {
        "source_table": "diagnosis",
        "target_table": "clinical_data",
        "source_column": "subject_id",
        "target_column": "subjectid",
        "relation_type": "M:N",
        "confidence": 0.6,
        "description": "Column name similarity suggests a possible patient identifier mapping (subject_id ~ subjectid), but clinical_data appears case/encounter-centric (caseid) and may not be in the same dataset namespace as INSPIRE tables. Without evidence that subjectid is unique per patient (or that subject_id values match), this cannot be validated as an FK.",
        "llm_inferred": true
      }
    ],
    "hierarchy": [
      {
        "level": 1,
        "entity_name": "Patient",
        "anchor_column": "subject_id",
        "mapping_table": null,
        "confidence": 0.72
      },
      {
        "level": 2,
        "entity_name": "DiagnosisEvent",
        "anchor_column": "subject_id",
        "mapping_table": "diagnosis",
        "confidence": 0.86
      },
      {
        "level": 2,
        "entity_name": "LabEvent",
        "anchor_column": "subject_id",
        "mapping_table": "labs",
        "confidence": 0.84
      },
      {
        "level": 2,
        "entity_name": "MedicationEvent",
        "anchor_column": "subject_id",
        "mapping_table": "medications",
        "confidence": 0.84
      },
      {
        "level": 2,
        "entity_name": "SurgicalCase/Encounter",
        "anchor_column": "caseid",
        "mapping_table": "clinical_data",
        "confidence": 0.8
      },
      {
        "level": 3,
        "entity_name": "LabMeasurement",
        "anchor_column": "caseid",
        "mapping_table": "lab_data",
        "confidence": 0.82
      }
    ],
    "reasoning": "FK validation: The shared columns (subject_id, chart_time) occur across multiple transactional/event tables (diagnosis, labs, medications). Such shared identifiers are commonly used for analytical joins, but they are not sufficient to assert FK constraints because (a) there is no explicit parent dimension table (e.g., patients) provided, (b) chart_time is repeated (not unique) and cannot serve as a referenced key, and (c) subject_id uniqueness_ratio=1.0 in the provided cardinality output is inconsistent with typical event tables and likely reflects a rule artifact rather than true uniqueness. Therefore, no strict FK is asserted; relationships are modeled conservatively as conceptual M:N associations through an implied Patient entity.\n\nRelationship types: Between event tables (diagnosis vs labs/medications), the natural relationship is many-to-many at the patient level (a patient can have many diagnoses and many labs/meds; each diagnosis code/time can co-occur with many labs/meds). Without an encounter_id, a true 1:N cannot be established.\n\nHierarchy: Domain-wise, Patient is the abstract parent entity; diagnosis/labs/medications are child event entities recorded over time. Separately, clinical_data is encounter/case-centric (caseid) and lab_data is a case-level measurement table; linking INSPIRE subject_id tables to Open_VitalDB caseid tables is uncertain, so they are kept as separate branches with low-confidence cross-mapping."
  },
  "prompt_hash": "9dbe287c12a26af38dc7057534fe4fa9",
  "cached_at": "2025-12-17T04:32:42.911290",
  "context_summary": {
    "filename": "unknown",
    "num_columns": 0
  }
}