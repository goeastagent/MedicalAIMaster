# Indexing Agent ì•„í‚¤í…ì²˜ ë° ë™ì‘ ì›ë¦¬

## ğŸ“– ê°œìš”

Indexing AgentëŠ” ì˜ë£Œ ë°ì´í„° íŒŒì¼(CSV, Signal ë“±)ì„ ë¶„ì„í•˜ì—¬:
1. **PostgreSQL ë°ì´í„°ë² ì´ìŠ¤**ì— ì •í˜•í™”ëœ í…Œì´ë¸”ë¡œ ì €ì¥
2. **Neo4j ê·¸ë˜í”„ ë°ì´í„°ë² ì´ìŠ¤**ì— ì˜¨í†¨ë¡œì§€(ì§€ì‹ ê·¸ë˜í”„)ë¥¼ êµ¬ì¶•

í•˜ëŠ” ìë™í™” ì—ì´ì „íŠ¸ì…ë‹ˆë‹¤.

í•µì‹¬ ì² í•™: **"Rule Prepares, LLM Decides"**
- ê·œì¹™ ê¸°ë°˜ ë¡œì§ì´ ë°ì´í„°ë¥¼ ì „ì²˜ë¦¬í•˜ê³  í›„ë³´ë¥¼ ì¶”ì¶œ
- LLMì´ ìµœì¢… íŒë‹¨ (ì˜ë¯¸ í•´ì„, ê´€ê³„ ì¶”ë¡ )
- ë¶ˆí™•ì‹¤í•  ë•ŒëŠ” ì‚¬ëŒì—ê²Œ ì§ˆë¬¸ (Human-in-the-Loop)

---

## ğŸ”„ 10-Phase Sequential Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ì…ë ¥: CSV/Signal íŒŒì¼                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 1: Directory Catalog (Rule-based)                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                            â”‚
â”‚  â€¢ ë””ë ‰í† ë¦¬ êµ¬ì¡° ë¶„ì„                                                 â”‚
â”‚  â€¢ íŒŒì¼ í™•ì¥ìë³„ ì¹´ìš´íŠ¸                                               â”‚
â”‚  â€¢ íŒŒì¼ëª… ìƒ˜í”Œ ìˆ˜ì§‘ (Phase 7ì—ì„œ LLM ë¶„ì„ìš©)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 2: File Catalog (Rule-based)                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚
â”‚  â€¢ íŒŒì¼ë³„ ë©”íƒ€ë°ì´í„° ì¶”ì¶œ (ì»¬ëŸ¼ëª…, íƒ€ì…, í†µê³„)                         â”‚
â”‚  â€¢ DB ì €ì¥ (file_catalog, column_metadata)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 3: Schema Aggregation (Rule-based)                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                           â”‚
â”‚  â€¢ ìœ ë‹ˆí¬ ì»¬ëŸ¼ëª… ì§‘ê³„                                                 â”‚
â”‚  â€¢ ëŒ€í‘œ í†µê³„ ê³„ì‚°                                                     â”‚
â”‚  â€¢ LLM ë°°ì¹˜ ì¤€ë¹„                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 4: File Classification (LLM)                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                 â”‚
â”‚  â€¢ íŒŒì¼ì„ "metadata" vs "data"ë¡œ ë¶„ë¥˜                                â”‚
â”‚  â€¢ ğŸ¤– LLM ì‚¬ìš©: íŒŒì¼ëª…, ì»¬ëŸ¼ëª…, ìƒ˜í”Œ ë°ì´í„° ë¶„ì„                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 5: Metadata Semantic (LLM)                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                   â”‚
â”‚  â€¢ metadata íŒŒì¼ì—ì„œ data_dictionary ì¶”ì¶œ                            â”‚
â”‚  â€¢ key, description, unit íŒŒì‹±                                       â”‚
â”‚  â€¢ ğŸ¤– LLM ì‚¬ìš©: ì»¬ëŸ¼ ì—­í•  ì¶”ë¡  (key/desc/unit)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 6: Data Semantic (LLM)                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                       â”‚
â”‚  â€¢ data íŒŒì¼ ì»¬ëŸ¼ ì˜ë¯¸ ë¶„ì„                                           â”‚
â”‚  â€¢ data_dictionaryì™€ ë§¤ì¹­                                            â”‚
â”‚  â€¢ ğŸ¤– LLM ì‚¬ìš©: ì»¬ëŸ¼ ì˜ë¯¸, concept_category ì¶”ë¡                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 7: Directory Pattern (LLM)                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                   â”‚
â”‚  â€¢ ë””ë ‰í† ë¦¬ë³„ íŒŒì¼ëª… íŒ¨í„´ ë¶„ì„                                         â”‚
â”‚  â€¢ ID ê°’ ì¶”ì¶œ (ì˜ˆ: 00001.vital â†’ caseid=00001)                       â”‚
â”‚  â€¢ ğŸ¤– LLM ì‚¬ìš©: íŒŒì¼ëª…ì—ì„œ ì˜ë¯¸ìˆëŠ” í•„ë“œ ì¶”ì¶œ                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 8: Entity Identification (LLM)                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                               â”‚
â”‚  â€¢ í…Œì´ë¸”ë³„ row_represents ì‹ë³„ (ê° í–‰ì´ ë¬´ì—‡ì„ ë‚˜íƒ€ë‚´ëŠ”ê°€)            â”‚
â”‚  â€¢ entity_identifier ì»¬ëŸ¼ ì‹ë³„ (í–‰ì„ ê³ ìœ í•˜ê²Œ ì‹ë³„í•˜ëŠ” ì»¬ëŸ¼)           â”‚
â”‚  â€¢ ğŸ¤– LLM ì‚¬ìš©: í…Œì´ë¸”ì˜ ì˜ë¯¸ë¡ ì  ì—­í•  ë¶„ì„                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 9: Relationship Inference (LLM + Neo4j)                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                      â”‚
â”‚  â€¢ í…Œì´ë¸” ê°„ FK ê´€ê³„ ì¶”ë¡                                              â”‚
â”‚  â€¢ Neo4jì— 3-Level Ontology êµ¬ì¶•                                     â”‚
â”‚  â€¢ ğŸ¤– LLM ì‚¬ìš©: FK ê´€ê³„, cardinality ì¶”ë¡                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase 10: Ontology Enhancement (LLM + Neo4j)                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â”‚
â”‚  â€¢ Concept Hierarchy (SubCategory ì„¸ë¶„í™”)                            â”‚
â”‚  â€¢ Semantic Edges (íŒŒë¼ë¯¸í„° ê°„ ì˜ë¯¸ ê´€ê³„)                             â”‚
â”‚  â€¢ Medical Term Mapping (SNOMED/LOINC ì½”ë“œ ë§¤í•‘)                     â”‚
â”‚  â€¢ ğŸ¤– LLM ì‚¬ìš©: ì˜ë£Œ ë„ë©”ì¸ ì§€ì‹ ì ìš©                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            ì¶œë ¥                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  ğŸ“Š PostgreSQL: í…Œì´ë¸” + ë©”íƒ€ë°ì´í„° + ê´€ê³„ ì •ë³´                       â”‚
â”‚  ğŸ§  Neo4j: ì˜¨í†¨ë¡œì§€ (Entities, Concepts, Relationships, Hierarchy)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Phaseë³„ ìƒì„¸ ì„¤ëª…

### Phase 1-3: Rule-based ë©”íƒ€ë°ì´í„° ìˆ˜ì§‘

| Phase | ì´ë¦„ | ì—­í•  | ì €ì¥ í…Œì´ë¸” |
|-------|------|------|------------|
| 1 | Directory Catalog | ë””ë ‰í† ë¦¬ êµ¬ì¡° ë¶„ì„ | directory_catalog |
| 2 | File Catalog | íŒŒì¼/ì»¬ëŸ¼ ë©”íƒ€ë°ì´í„° | file_catalog, column_metadata |
| 3 | Schema Aggregation | ìœ ë‹ˆí¬ ì»¬ëŸ¼ ì§‘ê³„ | (stateì—ë§Œ ì €ì¥) |

### Phase 4-10: LLM ê¸°ë°˜ ì˜ë¯¸ ë¶„ì„

| Phase | ì´ë¦„ | ì—­í•  | ì €ì¥ í…Œì´ë¸” |
|-------|------|------|------------|
| 4 | File Classification | metadata/data ë¶„ë¥˜ | file_catalog.is_metadata |
| 5 | Metadata Semantic | data_dictionary ì¶”ì¶œ | data_dictionary |
| 6 | Data Semantic | ì»¬ëŸ¼ ì˜ë¯¸ ë¶„ì„ | column_metadata (semantic í•„ë“œ) |
| 7 | Directory Pattern | íŒŒì¼ëª… íŒ¨í„´ ë¶„ì„ | directory_catalog, file_catalog |
| 8 | Entity Identification | row_represents ì‹ë³„ | table_entities |
| 9 | Relationship Inference | FK ê´€ê³„ ì¶”ë¡  | table_relationships, Neo4j |
| 10 | Ontology Enhancement | ì˜¨í†¨ë¡œì§€ í™•ì¥ | ë‹¤ìˆ˜ í…Œì´ë¸”, Neo4j |

---

## ğŸ¤– LLMì´ ì‚¬ìš©ë˜ëŠ” ê³³

### Phase 4: íŒŒì¼ ë¶„ë¥˜
```
ì…ë ¥: íŒŒì¼ëª…, ì»¬ëŸ¼ ëª©ë¡, ìƒ˜í”Œ ë°ì´í„°
ì§ˆë¬¸: "ì´ íŒŒì¼ì´ ë©”íƒ€ë°ì´í„°(ì½”ë“œë¶/ì‚¬ì „)ì¸ê°€ìš”, ì‹¤ì œ ë°ì´í„°ì¸ê°€ìš”?"
ì¶œë ¥: { is_metadata: true/false, confidence: 0.95, reasoning: "..." }
```

### Phase 5: ë©”íƒ€ë°ì´í„° ë¶„ì„
```
ì…ë ¥: metadata íŒŒì¼ì˜ ì»¬ëŸ¼ ì •ë³´
ì§ˆë¬¸: "ì–´ë–¤ ì»¬ëŸ¼ì´ key, description, unit ì—­í• ì¸ê°€ìš”?"
ì¶œë ¥: { key_column: "...", desc_column: "...", unit_column: "..." }
```

### Phase 6: ë°ì´í„° ì‹œë§¨í‹± ë¶„ì„
```
ì…ë ¥: data íŒŒì¼ì˜ ì»¬ëŸ¼ ì •ë³´ + data_dictionary ì»¨í…ìŠ¤íŠ¸
ì§ˆë¬¸: "ì´ ì»¬ëŸ¼ë“¤ì˜ ì˜ë¯¸ì™€ dictionary entry ë§¤ì¹­ ê²°ê³¼ëŠ”?"
ì¶œë ¥: [{ column: "...", semantic_name: "...", concept_category: "...", dict_match: "..." }, ...]
```

### Phase 7: ë””ë ‰í† ë¦¬ íŒ¨í„´ ë¶„ì„
```
ì…ë ¥: íŒŒì¼ëª… ìƒ˜í”Œ (ì˜ˆ: ["00001.vital", "00002.vital", ...])
ì§ˆë¬¸: "íŒŒì¼ëª…ì—ì„œ ì–´ë–¤ í•„ë“œë¥¼ ì¶”ì¶œí•  ìˆ˜ ìˆë‚˜ìš”?"
ì¶œë ¥: { pattern: "{caseid}.vital", columns: ["caseid"] }
```

### Phase 8: Entity ì‹ë³„
```
ì…ë ¥: í…Œì´ë¸” ì»¬ëŸ¼ ì •ë³´
ì§ˆë¬¸: "ì´ í…Œì´ë¸”ì˜ ê° í–‰ì€ ë¬´ì—‡ì„ ë‚˜íƒ€ë‚´ë‚˜ìš”? í–‰ì„ ê³ ìœ í•˜ê²Œ ì‹ë³„í•˜ëŠ” ì»¬ëŸ¼ì€?"
ì¶œë ¥: { row_represents: "surgery", entity_identifier: "caseid" }
```

### Phase 9: ê´€ê³„ ì¶”ë¡ 
```
ì…ë ¥: ë‘ í…Œì´ë¸”ì˜ Entity ì •ë³´
ì§ˆë¬¸: "ì´ í…Œì´ë¸”ë“¤ ê°„ì˜ FK ê´€ê³„ëŠ”?"
ì¶œë ¥: { source_column: "caseid", target_column: "caseid", cardinality: "1:N" }
```

### Phase 10: ì˜¨í†¨ë¡œì§€ ê°•í™”
```
ì…ë ¥: concept_categoryë³„ íŒŒë¼ë¯¸í„° ëª©ë¡
ì§ˆë¬¸: "ì´ íŒŒë¼ë¯¸í„°ë“¤ì„ ë” ì„¸ë¶„í™”í•˜ê³ , SNOMED/LOINC ì½”ë“œë¥¼ ë§¤í•‘í•´ì£¼ì„¸ìš”"
ì¶œë ¥: { subcategories: [...], medical_mappings: [...] }
```

---

## ğŸ‘¤ Human Review ë©”ì»¤ë‹ˆì¦˜

### ì–¸ì œ ì‚¬ëŒì—ê²Œ ë¬¼ì–´ë³´ë‚˜ìš”?

| ìƒí™© | ì¡°ê±´ | ì§ˆë¬¸ ì˜ˆì‹œ |
|------|------|-----------|
| íŒŒì¼ ë¶„ë¥˜ ë¶ˆí™•ì‹¤ | confidence < 90% | "ì´ íŒŒì¼ì´ ë©”íƒ€ë°ì´í„°ì¸ê°€ìš”, ë°ì´í„°ì¸ê°€ìš”?" |
| Entity ë¶ˆí™•ì‹¤ | confidence < 80% | "ì–´ë–¤ ì»¬ëŸ¼ì´ í™˜ì IDì¸ê°€ìš”?" |
| ê´€ê³„ ë¶ˆí™•ì‹¤ | confidence < 80% | "ì´ í…Œì´ë¸”ë“¤ ê°„ì˜ ê´€ê³„ê°€ ë§ë‚˜ìš”?" |

### ì„¤ì • ê°€ëŠ¥í•œ íŒŒë¼ë¯¸í„° (`config.py`)

| ì„¤ì • | ê¸°ë³¸ê°’ | ì„¤ëª… |
|------|--------|------|
| METADATA_CONFIDENCE_THRESHOLD | 0.90 | ì´ ê°’ ë¯¸ë§Œì´ë©´ Human Review |
| ANCHOR_CONFIDENCE_THRESHOLD | 0.90 | Anchor íŒë‹¨ ê¸°ì¤€ |
| USE_LLM_FOR_REVIEW_DECISION | true | LLM ì¶”ê°€ íŒë‹¨ í™œì„±í™” |
| MAX_RETRY_COUNT | 3 | ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ |

---

## ğŸ’¾ ì €ì¥ë˜ëŠ” DB í…Œì´ë¸”

### PostgreSQL

| í…Œì´ë¸” | ìƒì„± Phase | ì„¤ëª… |
|--------|-----------|------|
| directory_catalog | 1, 7 | ë””ë ‰í† ë¦¬ ë©”íƒ€ë°ì´í„° + íŒŒì¼ëª… íŒ¨í„´ |
| file_catalog | 2, 4 | íŒŒì¼ ë©”íƒ€ë°ì´í„° + ë¶„ë¥˜ ê²°ê³¼ |
| column_metadata | 2, 6 | ì»¬ëŸ¼ ë©”íƒ€ë°ì´í„° + ì‹œë§¨í‹± ì •ë³´ |
| data_dictionary | 5 | íŒŒë¼ë¯¸í„° ì •ì˜ (key, desc, unit) |
| table_entities | 8 | í…Œì´ë¸” Entity ì •ë³´ |
| table_relationships | 9 | FK ê´€ê³„ |
| ontology_subcategories | 10 | SubCategory ì„¸ë¶„í™” |
| semantic_edges | 10 | íŒŒë¼ë¯¸í„° ê°„ ì˜ë¯¸ ê´€ê³„ |
| medical_term_mappings | 10 | SNOMED/LOINC ë§¤í•‘ |
| cross_table_semantics | 10 | í…Œì´ë¸” ê°„ ì‹œë§¨í‹± ê´€ê³„ |

### Neo4j

| ë…¸ë“œ íƒ€ì… | ìƒì„± Phase | ì„¤ëª… |
|----------|-----------|------|
| RowEntity | 9 | í…Œì´ë¸”ì´ ë‚˜íƒ€ë‚´ëŠ” Entity |
| ConceptCategory | 9 | ê°œë… ì¹´í…Œê³ ë¦¬ (Vital Signs ë“±) |
| SubCategory | 10 | ì„¸ë¶„í™”ëœ ì¹´í…Œê³ ë¦¬ |
| Parameter | 9, 10 | ì¸¡ì • íŒŒë¼ë¯¸í„° |
| MedicalTerm | 10 | í‘œì¤€ ì˜ë£Œ ìš©ì–´ |

| ê´€ê³„ íƒ€ì… | ìƒì„± Phase | ì„¤ëª… |
|----------|-----------|------|
| LINKS_TO | 9 | í…Œì´ë¸” ê°„ FK ê´€ê³„ |
| HAS_CONCEPT | 9 | Entity â†’ Category |
| HAS_SUBCATEGORY | 10 | Category â†’ SubCategory |
| CONTAINS | 9 | Category â†’ Parameter |
| HAS_COLUMN | 9 | Entity â†’ Parameter |
| DERIVED_FROM | 10 | íŒŒë¼ë¯¸í„° íŒŒìƒ ê´€ê³„ |
| RELATED_TO | 10 | íŒŒë¼ë¯¸í„° ìƒê´€ ê´€ê³„ |
| MAPS_TO | 10 | í‘œì¤€ ìš©ì–´ ë§¤í•‘ |

---

## ğŸ”§ ì‹¤í–‰ ë°©ë²•

### 1. ì„œë¹„ìŠ¤ ì‹œì‘
```bash
cd IndexingAgent
./run_postgres_neo4j.sh   # PostgreSQL + Neo4j ì‹¤í–‰
```

### 2. ì¸ë±ì‹± ì‹¤í–‰
```bash
python test_full_pipeline_results.py
```

### 3. ê²°ê³¼ í™•ì¸
```bash
python view_database.py    # PostgreSQL í…Œì´ë¸” í™•ì¸
python view_ontology.py    # Neo4j ì˜¨í†¨ë¡œì§€ í™•ì¸
```

---

## ğŸ“ íŒŒì¼ êµ¬ì¡°

```
IndexingAgent/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ agents/
â”‚   â”‚   â”œâ”€â”€ graph.py              # LangGraph ì›Œí¬í”Œë¡œìš° ì •ì˜
â”‚   â”‚   â”œâ”€â”€ state.py              # ìƒíƒœ ê°ì²´ ì •ì˜
â”‚   â”‚   â””â”€â”€ nodes/
â”‚   â”‚       â”œâ”€â”€ __init__.py       # ë…¸ë“œ ëª¨ë“ˆ export
â”‚   â”‚       â”œâ”€â”€ directory_catalog.py   # Phase 1
â”‚   â”‚       â”œâ”€â”€ catalog.py             # Phase 2
â”‚   â”‚       â”œâ”€â”€ aggregator.py          # Phase 3
â”‚   â”‚       â”œâ”€â”€ classification.py      # Phase 4
â”‚   â”‚       â”œâ”€â”€ metadata_semantic.py   # Phase 5
â”‚   â”‚       â”œâ”€â”€ data_semantic.py       # Phase 6
â”‚   â”‚       â”œâ”€â”€ directory_pattern.py   # Phase 7
â”‚   â”‚       â”œâ”€â”€ entity_identification.py # Phase 8
â”‚   â”‚       â”œâ”€â”€ relationship_inference.py # Phase 9
â”‚   â”‚       â””â”€â”€ ontology_enhancement.py   # Phase 10
â”‚   â”œâ”€â”€ processors/
â”‚   â”‚   â”œâ”€â”€ tabular.py            # CSV ì²˜ë¦¬ê¸°
â”‚   â”‚   â””â”€â”€ signal.py             # Signal íŒŒì¼ ì²˜ë¦¬ê¸°
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”œâ”€â”€ connection.py         # PostgreSQL ì—°ê²°
â”‚   â”‚   â”œâ”€â”€ neo4j_connection.py   # Neo4j ì—°ê²°
â”‚   â”‚   â”œâ”€â”€ schema_catalog.py     # file_catalog, column_metadata
â”‚   â”‚   â”œâ”€â”€ schema_directory.py   # directory_catalog
â”‚   â”‚   â”œâ”€â”€ schema_dictionary.py  # data_dictionary
â”‚   â”‚   â””â”€â”€ schema_ontology.py    # ì˜¨í†¨ë¡œì§€ ê´€ë ¨ í…Œì´ë¸”
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ llm_client.py         # LLM API í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚   â””â”€â”€ llm_cache.py          # LLM ì‘ë‹µ ìºì‹œ
â”‚   â””â”€â”€ config.py                 # ì„¤ì • (Phaseë³„ Config í´ë˜ìŠ¤)
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ raw/                      # ì›ë³¸ ë°ì´í„° íŒŒì¼
â”‚   â””â”€â”€ cache/llm_disk/           # LLM ì‘ë‹µ ìºì‹œ
â””â”€â”€ test_full_pipeline_results.py # ì „ì²´ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ + ê²°ê³¼ í™•ì¸
```

---

## ğŸ¯ ì„¤ê³„ ì›ì¹™

1. **10-Phase Sequential Pipeline**: ëª…í™•í•˜ê²Œ ë¶„ë¦¬ëœ 10ë‹¨ê³„ ì²˜ë¦¬
2. **Rule Prepares, LLM Decides**: ê·œì¹™ ê¸°ë°˜ ì „ì²˜ë¦¬ + LLM ìµœì¢… íŒë‹¨
3. **Human-in-the-Loop**: ë¶ˆí™•ì‹¤í•  ë•ŒëŠ” ì‚¬ëŒì—ê²Œ í™•ì¸
4. **ìºì‹± ìµœì í™”**: ë™ì¼í•œ LLM ì§ˆë¬¸ì€ ì¬ì‚¬ìš©í•˜ì—¬ ë¹„ìš© ì ˆê°
5. **ì ì§„ì  í•™ìŠµ**: íŒŒì¼ì„ ì²˜ë¦¬í• ìˆ˜ë¡ ì˜¨í†¨ë¡œì§€ê°€ í’ë¶€í•´ì§
