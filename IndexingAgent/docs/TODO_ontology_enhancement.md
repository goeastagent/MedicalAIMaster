# ì˜¨í†¨ë¡œì§€ ê°•í™” TODO

## ê°œìš”
VitalDB ìˆ˜ì¤€ì˜ ë°ì´í„° ì²˜ë¦¬ëŠ” í˜„ì¬ MVP ì˜¨í†¨ë¡œì§€ë¡œ ì¶©ë¶„í•˜ì§€ë§Œ, 
ë³µì¡í•œ ì˜ë£Œ ë°ì´í„°(OMOP, FHIR ë“±)ë¥¼ ì²˜ë¦¬í•˜ë ¤ë©´ ê³„ì¸µ êµ¬ì¡°ì™€ ìš©ì–´ ë§¤í•‘ì´ í•„ìš”í•¨.

**í•µì‹¬ ì›ì¹™**: ëª¨ë“  ê²ƒì„ LLMì´ ë™ì ìœ¼ë¡œ ìƒì„±í•œë‹¤ (ì •ì  í…Œì´ë¸” ê¸ˆì§€)

---

## ğŸ—ï¸ í˜„ì¬ ì•„í‚¤í…ì²˜ (2024-12 ë¦¬íŒ©í† ë§ ì™„ë£Œ)

### 10-Node Sequential Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        IndexingAgent Pipeline                                â”‚
â”‚                     (LangGraph StateGraph ê¸°ë°˜)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ ğŸ“‚ Directory    â”‚â”€â”€â–¶â”‚ ğŸ“ File         â”‚â”€â”€â–¶â”‚ ğŸ”„ Schema       â”‚           â”‚
â”‚  â”‚ Catalog         â”‚   â”‚ Catalog         â”‚   â”‚ Aggregation     â”‚           â”‚
â”‚  â”‚ (order=100)     â”‚   â”‚ (order=200)     â”‚   â”‚ (order=300)     â”‚           â”‚
â”‚  â”‚ Rule-based      â”‚   â”‚ Rule-based      â”‚   â”‚ Rule-based      â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚          â”‚                                            â”‚                     â”‚
â”‚          â–¼                                            â–¼                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚                    PostgreSQL Tables                            â”‚       â”‚
â”‚  â”‚  â€¢ directory_catalog  â€¢ file_catalog  â€¢ column_metadata        â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ ğŸ·ï¸ File         â”‚â”€â”€â–¶â”‚ ğŸ“– Metadata     â”‚â”€â”€â–¶â”‚ ğŸ“Š Data         â”‚           â”‚
â”‚  â”‚ Classification  â”‚   â”‚ Semantic        â”‚   â”‚ Semantic        â”‚           â”‚
â”‚  â”‚ (order=400)     â”‚   â”‚ (order=500)     â”‚   â”‚ (order=600)     â”‚           â”‚
â”‚  â”‚ ğŸ¤– LLM          â”‚   â”‚ ğŸ¤– LLM          â”‚   â”‚ ğŸ¤– LLM          â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚          â”‚                    â”‚                      â”‚                     â”‚
â”‚          â–¼                    â–¼                      â–¼                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  â€¢ file_catalog.is_metadata  â€¢ data_dictionary  â€¢ column_metadataâ”‚      â”‚
â”‚  â”‚    (metadata vs data ë¶„ë¥˜)     (key-desc-unit)   (semantic_type) â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ ğŸ“ Directory    â”‚â”€â”€â–¶â”‚ ğŸ·ï¸ Entity       â”‚â”€â”€â–¶â”‚ ğŸ”— Relationship â”‚           â”‚
â”‚  â”‚ Pattern         â”‚   â”‚ Identification  â”‚   â”‚ Inference       â”‚           â”‚
â”‚  â”‚ (order=700)     â”‚   â”‚ (order=800)     â”‚   â”‚ (order=900)     â”‚           â”‚
â”‚  â”‚ ğŸ¤– LLM          â”‚   â”‚ ğŸ¤– LLM          â”‚   â”‚ ğŸ¤– LLM          â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚          â”‚                    â”‚                      â”‚                     â”‚
â”‚          â–¼                    â–¼                      â–¼                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  â€¢ directory_catalog      â€¢ table_entities      â€¢ table_relationships  â”‚
â”‚  â”‚    (filename_pattern)       (row_represents)      (FK relations)       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ ğŸ§  Ontology Enhancement (order=1000) ğŸ¤– LLM                     â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  Task 1: Concept Hierarchy                                       â”‚       â”‚
â”‚  â”‚    ConceptCategory â†’ SubCategory ì„¸ë¶„í™”                          â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  Task 2: Semantic Edges                                          â”‚       â”‚
â”‚  â”‚    Parameter ê°„ ê´€ê³„ (RELATED_TO, DERIVED_FROM)                  â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  Task 3: Medical Term Mapping                                    â”‚       â”‚
â”‚  â”‚    SNOMED-CT, LOINC, ICD-10 ë§¤í•‘                                 â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  Task 4: Cross-table Semantics                                   â”‚       â”‚
â”‚  â”‚    í…Œì´ë¸” ê°„ ì‹œë§¨í‹± ìœ ì‚¬ì„± íƒì§€                                   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚          â”‚                                                                  â”‚
â”‚          â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚            PostgreSQL ontology_enhancement Tables                â”‚       â”‚
â”‚  â”‚  â€¢ ontology_subcategories  â€¢ semantic_edges                     â”‚       â”‚
â”‚  â”‚  â€¢ medical_term_mappings   â€¢ cross_table_semantics              â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚                    Neo4j Knowledge Graph                        â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  Nodes:                                                          â”‚       â”‚
â”‚  â”‚    (:RowEntity)  (:ConceptCategory)  (:SubCategory)             â”‚       â”‚
â”‚  â”‚    (:Parameter)  (:MedicalTerm)                                  â”‚       â”‚
â”‚  â”‚                                                                  â”‚       â”‚
â”‚  â”‚  Relationships:                                                  â”‚       â”‚
â”‚  â”‚    -[:LINKS_TO]->  -[:HAS_CONCEPT]->  -[:HAS_SUBCATEGORY]->     â”‚       â”‚
â”‚  â”‚    -[:CONTAINS]->  -[:HAS_COLUMN]->   -[:DERIVED_FROM]->        â”‚       â”‚
â”‚  â”‚    -[:RELATED_TO]->  -[:MAPS_TO]->                              â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í•µì‹¬ íŒŒì¼ êµ¬ì¡°

```
IndexingAgent/src/
â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ base/
â”‚   â”‚   â”œâ”€â”€ node.py          # BaseNode ì¶”ìƒ í´ë˜ìŠ¤
â”‚   â”‚   â””â”€â”€ mixins.py        # LLMMixin, DatabaseMixin, LoggingMixin
â”‚   â”œâ”€â”€ nodes/
â”‚   â”‚   â”œâ”€â”€ directory_catalog.py     # order=100, Rule-based
â”‚   â”‚   â”œâ”€â”€ catalog.py               # order=200, Rule-based
â”‚   â”‚   â”œâ”€â”€ aggregator.py            # order=300, Rule-based
â”‚   â”‚   â”œâ”€â”€ classification.py        # order=400, LLM
â”‚   â”‚   â”œâ”€â”€ metadata_semantic.py     # order=500, LLM
â”‚   â”‚   â”œâ”€â”€ data_semantic.py         # order=600, LLM
â”‚   â”‚   â”œâ”€â”€ directory_pattern.py     # order=700, LLM
â”‚   â”‚   â”œâ”€â”€ entity_identification.py # order=800, LLM
â”‚   â”‚   â”œâ”€â”€ relationship_inference.py# order=900, LLM
â”‚   â”‚   â””â”€â”€ ontology_enhancement.py  # order=1000, LLM
â”‚   â”œâ”€â”€ registry.py          # NodeRegistry (ë™ì  ë…¸ë“œ ê´€ë¦¬)
â”‚   â”œâ”€â”€ graph.py             # build_agent() (ë™ì  íŒŒì´í”„ë¼ì¸ ë¹Œë“œ)
â”‚   â””â”€â”€ state.py             # AgentState TypedDict
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â”œâ”€â”€ directory.py      # directory_catalog
â”‚   â”‚   â”œâ”€â”€ catalog.py        # file_catalog, column_metadata
â”‚   â”‚   â”œâ”€â”€ dictionary.py     # data_dictionary
â”‚   â”‚   â”œâ”€â”€ ontology_core.py  # table_entities, table_relationships
â”‚   â”‚   â””â”€â”€ ontology_enhancement.py # subcategories, semantic_edges, ...
â”‚   â””â”€â”€ managers/
â”‚       â””â”€â”€ ontology.py       # OntologySchemaManager
â””â”€â”€ utils/
    â””â”€â”€ llm_client.py         # LLMClient (Singleton)
```

---

## TODO-1: Value Mappings âœ… ì™„ë£Œ (data_semantic)

### ëª©í‘œ
- LLMì´ ë°ì´í„° ê°’ì˜ ì˜ë¯¸ë¥¼ ì¶”ë¡ í•˜ì—¬ ì €ì¥
- ì˜ˆ: `sex` ì»¬ëŸ¼ì˜ `0` â†’ `Male`, `1` â†’ `Female`

### êµ¬í˜„ ì™„ë£Œ í•­ëª©
- [x] `DataSemanticNode` í”„ë¡¬í”„íŠ¸ì— `value_mappings` ìš”ì²­ ì¶”ê°€
- [x] ì‘ë‹µ íŒŒì‹±ì— `value_mappings` ì¶”ê°€

### ì €ì¥ ìœ„ì¹˜
- PostgreSQL `column_metadata` í…Œì´ë¸”ì˜ ê¸°ì¡´ JSONB í•„ë“œ í™œìš©

### ì˜í–¥ë°›ëŠ” íŒŒì¼
- `src/agents/nodes/data_semantic.py` - LLM í”„ë¡¬í”„íŠ¸ ë° íŒŒì‹±

---

## TODO-2: Intra-table Hierarchy ğŸš§ ë¯¸êµ¬í˜„ (data_semantic)

### ëª©í‘œ
- í…Œì´ë¸” ë‚´ ID ì»¬ëŸ¼ ê°„ì˜ ê³„ì¸µ ê´€ê³„ ê°ì§€ ë° ì €ì¥
- ì˜ˆ: `subjectid` (í™˜ì) â†’ `caseid` (ìˆ˜ìˆ ) = 1:N ê´€ê³„
- ì´ ê´€ê³„ë¥¼ ëª¨ë¥´ë©´ "í™˜ì ë‹¨ìœ„ ë¶„ì„"ì¸ì§€ "ìˆ˜ìˆ  ë‹¨ìœ„ ë¶„ì„"ì¸ì§€ í˜¼ë™

### í•˜ì´ë¸Œë¦¬ë“œ ì €ì¥ ì „ëµ

| ì €ì¥ì†Œ | ì—­í•  | ìš©ë„ |
|--------|------|------|
| **PostgreSQL** | ë¬¼ë¦¬ì  ì°¸ì¡° | ë¹ ë¥¸ SQL ìƒì„± |
| **Neo4j** | ë…¼ë¦¬ì  ì¡±ë³´ | ë³µì¡í•œ ì¶”ë¡  ì¿¼ë¦¬ |

### êµ¬í˜„ í•­ëª©

#### 1.1 LLM í”„ë¡¬í”„íŠ¸ ê°•í™”
- [ ] `DataSemanticNode` í”„ë¡¬í”„íŠ¸ì— `intra_table_hierarchy` ìš”ì²­ ì¶”ê°€

**í”„ë¡¬í”„íŠ¸:**
```
12. intra_table_hierarchy: (ONLY for ID/key columns)
    Analyze if there's a parent-child relationship between ID columns.
    - Look for patterns like: same parent_id appearing with multiple child_ids
    - Example: subjectid=1001 has caseid=[001, 002, 003]
    
    Format:
    {
        "child_column": "caseid",
        "parent_column": "subjectid",
        "cardinality": "N:1",
        "reasoning": "subjectid 1001 appears with multiple caseids"
    }
```

#### 1.2 PostgreSQL column_metadata í™•ì¥
- [ ] `parent_column` í•„ë“œ ì¶”ê°€
- [ ] `cardinality` í•„ë“œ ì¶”ê°€

```json
{
  "full_name": "Surgery Case ID",
  "description": "...",
  "parent_column": "subjectid",
  "cardinality": "N:1"
}
```

#### 1.3 Neo4j ê´€ê³„ ì €ì¥
- [ ] `(:Column) -[:CHILD_OF]-> (:Column)` ê´€ê³„ ì €ì¥ ë©”ì„œë“œ ì¶”ê°€

```cypher
(:Column {name: 'caseid', table: 'clinical_data'})
  -[:CHILD_OF {cardinality: 'N:1'}]->
(:Column {name: 'subjectid', table: 'clinical_data'})
```

### ì˜í–¥ë°›ëŠ” íŒŒì¼
- `src/agents/nodes/data_semantic.py` - í”„ë¡¬í”„íŠ¸ ìˆ˜ì •
- `src/agents/nodes/relationship_inference.py` - hierarchy ì €ì¥ ë¡œì§ ì¶”ê°€
- `src/database/managers/ontology.py` - Neo4j CHILD_OF ê´€ê³„ ì €ì¥

---

## TODO-3: Concept Layer & Standard Mapping ğŸ”® ë‚˜ì¤‘

### ëª©í‘œ
- ì™¸ë¶€ ì§€ì‹ ê·¸ë˜í”„(SNOMED, LOINC ë“±) ì—°ë™
- Column â†’ Concept ë§¤í•‘
- Concept ê°„ ê³„ì¸µ êµ¬ì¡° (IS_A ê´€ê³„)

### êµ¬ì¡° (TODO-3 ì™„ë£Œ í›„)
```
(:Column {name: 'caseid'}) 
  -[:MAPS_TO]-> 
(:Concept {name: 'Surgery Case'}) 
  -[:PART_OF]-> 
(:Concept {name: 'Patient'})
```

### í•„ìš” ì‚¬í•­
- [ ] ì™¸ë¶€ KG API ì—°ë™ (SNOMED CT, LOINC, OMOP)
- [ ] LLMì´ í›„ë³´ ì œì•ˆ â†’ KGì—ì„œ ê²€ì¦

---

## TODO-4: Metadata Enhancement ğŸ”® ë‚˜ì¤‘ (metadata_semantic)

### ëª©í‘œ
- ë©”íƒ€ë°ì´í„° íŒŒì¼ ì²˜ë¦¬ ì‹œ ê³„ì¸µ êµ¬ì¡° ì¶”ë¡ 
- í˜„ì¬ëŠ” flatí•œ key-valueë§Œ ì €ì¥

### í˜„ì¬ ë¬¸ì œ
```python
# í˜„ì¬: ë‹¨ìˆœ íŒŒì‹±
definitions["sbp"] = "systolic blood pressure | unit=mmHg"

# ê°œì„  í•„ìš”: LLMì´ ê³„ì¸µ ì¶”ë¡ 
{
  "sbp": {
    "definition": "systolic blood pressure",
    "parent_concept": "Blood Pressure",
    "grandparent": "Hemodynamics"
  }
}
```

### ì˜í–¥ë°›ëŠ” íŒŒì¼
- `src/agents/nodes/metadata_semantic.py` - ê³„ì¸µ ì¶”ë¡  í”„ë¡¬í”„íŠ¸ ì¶”ê°€

---

## ì €ì¥ ìœ„ì¹˜ ì •ë¦¬

| ë°ì´í„° | ì €ì¥ ìœ„ì¹˜ | ì´ìœ  |
|--------|----------|------|
| Value Mappings | PostgreSQL `column_metadata` | ì»¬ëŸ¼ë³„ ë©”íƒ€ë°ì´í„° |
| Intra-table Hierarchy | PostgreSQL + Neo4j | ë¬¼ë¦¬ì  + ë…¼ë¦¬ì  |
| Inter-table FK | PostgreSQL `table_relationships` + Neo4j | í…Œì´ë¸” ê°„ ê´€ê³„ |
| Concept Hierarchy | Neo4j (ë‚˜ì¤‘) | ê°œë…ì  ê³„ì¸µ |
| Subcategories | PostgreSQL `ontology_subcategories` + Neo4j | ontology_enhancement |
| Semantic Edges | PostgreSQL `semantic_edges` + Neo4j | ontology_enhancement |
| Medical Term Mappings | PostgreSQL `medical_term_mappings` + Neo4j | ontology_enhancement |
| Cross-table Semantics | PostgreSQL `cross_table_semantics` | ontology_enhancement |

---

## ì§„í–‰ ìƒíƒœ

- [x] TODO-1: Value Mappings í”„ë¡¬í”„íŠ¸ ì¶”ê°€ (data_semantic)
- [x] TODO-1: Value Mappings íŒŒì‹± ì¶”ê°€
- [ ] TODO-2: Intra-table Hierarchy í”„ë¡¬í”„íŠ¸ ì¶”ê°€ (data_semantic)
- [ ] TODO-2: Hierarchy PostgreSQL ì €ì¥
- [ ] TODO-2: Hierarchy Neo4j ì €ì¥
- [ ] TODO-2: í…ŒìŠ¤íŠ¸ ë° ê²€ì¦
- [ ] TODO-3: Concept Layer ì„¤ê³„
- [ ] TODO-4: Metadata Enhancement (metadata_semantic)

---

## í•˜ì§€ ë§ì•„ì•¼ í•  ê²ƒ âŒ

1. **ì •ì  í…Œì´ë¸” ìƒì„± ê¸ˆì§€**
   - `CREATE TABLE concept_hierarchy` âŒ
   - `CREATE TABLE vocabulary_mappings` âŒ

2. **ìŠ¤í‚¤ë§ˆ ê³ ì • ê¸ˆì§€**
   - JSONBì˜ ìœ ì—°ì„± í™œìš©
   - LLMì´ ìƒˆë¡œìš´ í•„ë“œë¥¼ ë™ì ìœ¼ë¡œ ì¶”ê°€ ê°€ëŠ¥í•˜ê²Œ

---

## ì „ì²´ ë°ì´í„° íë¦„ (Sequence Diagram)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚ Input  â”‚     â”‚   10-Node      â”‚     â”‚   PostgreSQL   â”‚     â”‚ Neo4j â”‚
â”‚ Files  â”‚     â”‚   Pipeline     â”‚     â”‚   (Primary)    â”‚     â”‚ (Graph)â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”¬â”€â”€â”€â”˜
     â”‚                 â”‚                      â”‚                  â”‚
     â”‚  Scan Files     â”‚                      â”‚                  â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                      â”‚                  â”‚
     â”‚                 â”‚                      â”‚                  â”‚
     â”‚                 â”‚ directory_catalog    â”‚                  â”‚
     â”‚                 â”‚ file_catalog         â”‚                  â”‚
     â”‚                 â”‚ schema_aggregation   â”‚                  â”‚
     â”‚                 â”‚ (Rule-based)         â”‚                  â”‚
     â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                  â”‚
     â”‚                 â”‚  directory_catalog   â”‚                  â”‚
     â”‚                 â”‚  file_catalog        â”‚                  â”‚
     â”‚                 â”‚  column_metadata     â”‚                  â”‚
     â”‚                 â”‚                      â”‚                  â”‚
     â”‚                 â”‚ file_classification  â”‚                  â”‚
     â”‚                 â”‚ â†’ directory_pattern  â”‚                  â”‚
     â”‚                 â”‚ (LLM Analysis)       â”‚                  â”‚
     â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                  â”‚
     â”‚                 â”‚  is_metadata         â”‚                  â”‚
     â”‚                 â”‚  data_dictionary     â”‚                  â”‚
     â”‚                 â”‚  semantic_type       â”‚                  â”‚
     â”‚                 â”‚  filename_pattern    â”‚                  â”‚
     â”‚                 â”‚                      â”‚                  â”‚
     â”‚                 â”‚ entity_identificationâ”‚                  â”‚
     â”‚                 â”‚ relationship_inference                  â”‚
     â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                  â”‚
     â”‚                 â”‚  table_entities      â”‚                  â”‚
     â”‚                 â”‚  table_relationships â”‚                  â”‚
     â”‚                 â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚                 â”‚                      â”‚  RowEntity       â”‚
     â”‚                 â”‚                      â”‚  ConceptCategory â”‚
     â”‚                 â”‚                      â”‚  LINKS_TO        â”‚
     â”‚                 â”‚                      â”‚                  â”‚
     â”‚                 â”‚ ontology_enhancement â”‚                  â”‚
     â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                  â”‚
     â”‚                 â”‚  subcategories       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚                 â”‚  semantic_edges      â”‚  SubCategory     â”‚
     â”‚                 â”‚  medical_mappings    â”‚  Parameter       â”‚
     â”‚                 â”‚  cross_table_sem     â”‚  MedicalTerm     â”‚
     â”‚                 â”‚                      â”‚  DERIVED_FROM    â”‚
     â”‚                 â”‚                      â”‚  MAPS_TO         â”‚
     â”‚                 â”‚                      â”‚                  â”‚
     â”‚                 â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                 â”‚  Pipeline Complete   â”‚                  â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚                  â”‚
     â”‚  Results        â”‚                      â”‚                  â”‚
     â”‚                 â”‚                      â”‚                  â”‚
```

---

## í´ë˜ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ (Node Architecture)

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   <<abstract>>       â”‚
                    â”‚     BaseNode         â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ + name: str          â”‚
                    â”‚ + description: str   â”‚
                    â”‚ + order: int         â”‚
                    â”‚ + requires_llm: bool â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ + execute(state)     â”‚
                    â”‚ + __call__(state)    â”‚
                    â”‚ + log(msg, indent)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                     â”‚                     â”‚
         â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   <<mixin>>     â”‚   â”‚   <<mixin>>     â”‚   â”‚   <<mixin>>     â”‚
â”‚   LLMMixin      â”‚   â”‚  DatabaseMixin  â”‚   â”‚  LoggingMixin   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ + llm_client    â”‚   â”‚ + db_manager    â”‚   â”‚ + log_section   â”‚
â”‚ + call_llm()    â”‚   â”‚ + get_connectionâ”‚   â”‚ + log_progress  â”‚
â”‚ + call_llm_json â”‚   â”‚ + execute_query â”‚   â”‚ + log_stats     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                     â”‚                     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                     â”‚                     â”‚
         â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DirectoryCatalogâ”‚   â”‚ FileClassification   â”‚ OntologyEnhancementâ”‚
â”‚ Node            â”‚   â”‚ Node            â”‚   â”‚ Node            â”‚
â”‚ order=100       â”‚   â”‚ order=400       â”‚   â”‚ order=1000      â”‚
â”‚ (Rule-based)    â”‚   â”‚ (LLM)           â”‚   â”‚ (LLM)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         ...                 ...                   ...
```

---

## NodeRegistry ë™ì‘ ë°©ì‹

```python
# ë…¸ë“œ ë“±ë¡ (ë°ì½”ë ˆì´í„° ë°©ì‹)
@register_node
class MyCustomNode(BaseNode, LLMMixin):
    name = "my_custom"
    order = 550  # metadata_semantic(500)ê³¼ data_semantic(600) ì‚¬ì´ì— ì‚½ì…
    
    def execute(self, state):
        # ë¡œì§
        return {"result": ...}

# íŒŒì´í”„ë¼ì¸ ë¹Œë“œ
from src.agents.graph import build_agent

# ëª¨ë“  ë…¸ë“œ í¬í•¨
workflow = build_agent()

# íŠ¹ì • ë…¸ë“œë§Œ í¬í•¨
workflow = build_agent(include_nodes=["directory_catalog", "file_catalog"])

# íŠ¹ì • ë…¸ë“œ ì œì™¸
workflow = build_agent(exclude_nodes=["ontology_enhancement"])

# íŠ¹ì • ë…¸ë“œê¹Œì§€ë§Œ ì‹¤í–‰
workflow = build_partial_agent(until_node="entity_identification")
```
